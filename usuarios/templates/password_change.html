{% extends 'base.html' %}

{% block title %}Cambiar Contraseña - Hotel Elegante{% endblock %}

{% block content %}
<div class="auth-page" style="background-image: url('/static/img/hotel-luxury-bg.jpg'); background-size: cover; background-position: center; min-height: 100vh; display: flex; align-items: center; justify-content: center; position: relative;">
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to right, rgba(32, 32, 32, 0.8), rgba(64, 64, 64, 0.6));"></div>
    <div class="password-change-container" style="width: 100%; max-width: 500px; padding: 0 20px; position: relative; z-index: 10;">
        <div class="password-change-card" style="background: #fff; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; border: 1px solid #f0f0f0;">
            <div class="card-header" style="padding: 30px; text-align: center; background: linear-gradient(135deg, #d4af37, #f5cc7f); color: #fff;">
                <h2 style="margin: 0; font-family: 'Playfair Display', serif; font-size: 1.8rem;"><i class="fas fa-lock" style="margin-right: 10px;"></i> Cambiar Contraseña</h2>
                <p style="margin: 10px 0 0; font-size: 1rem; opacity: 0.9;">Actualiza tu contraseña para mantener tu cuenta segura</p>
            </div>
            
            <div class="card-body" style="padding: 30px;">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" style="border-radius: 5px; margin-bottom: 20px; padding: 12px 15px; background-color: {% if message.tags == 'success' %}#d4edda{% elif message.tags == 'error' %}#f8d7da{% else %}#cce5ff{% endif %}; color: {% if message.tags == 'success' %}#155724{% elif message.tags == 'error' %}#721c24{% else %}#004085{% endif %}; border: 1px solid {% if message.tags == 'success' %}#c3e6cb{% elif message.tags == 'error' %}#f5c6cb{% else %}#b8daff{% endif %};" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" style="position: absolute; right: 10px; top: 10px; font-size: 1.25rem; font-weight: 700; line-height: 1; color: #000; opacity: 0.5;"></button>
                        </div>
                    {% endfor %}
                {% endif %}

                    <form method="post" id="password-change-form" style="margin-top: 10px;">
                        {% csrf_token %}
                        
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="old_password" style="display: block; margin-bottom: 8px; color: #555; font-weight: 500;">
                                <i class="fas fa-key" style="color: #d4af37; margin-right: 8px;"></i> Contraseña Actual
                            </label>
                            <div class="input-group" style="display: flex;">
                                <input type="password" style="flex: 1; border-radius: 5px 0 0 5px; border: 1px solid #e0e0e0; padding: 12px 15px; transition: all 0.3s ease;" id="old_password" name="old_password" required>
                                <button style="background: #f5f5f5; border: 1px solid #e0e0e0; border-left: none; border-radius: 0 5px 5px 0; padding: 0 15px; cursor: pointer;" type="button" onclick="togglePassword('old_password')">
                                    <i class="fas fa-eye" id="old_password_icon" style="color: #777;"></i>
                                </button>
                            </div>
                            {% if form.old_password.errors %}
                                <div style="margin-top: 5px; color: #dc3545;">
                                    {% for error in form.old_password.errors %}
                                        <small style="font-size: 0.85rem;">{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="new_password1" style="display: block; margin-bottom: 8px; color: #555; font-weight: 500;">
                                <i class="fas fa-lock" style="color: #d4af37; margin-right: 8px;"></i> Nueva Contraseña
                            </label>
                            <div class="input-group" style="display: flex;">
                                <input type="password" style="flex: 1; border-radius: 5px 0 0 5px; border: 1px solid #e0e0e0; padding: 12px 15px; transition: all 0.3s ease;" id="new_password1" name="new_password1" required>
                                <button style="background: #f5f5f5; border: 1px solid #e0e0e0; border-left: none; border-radius: 0 5px 5px 0; padding: 0 15px; cursor: pointer;" type="button" onclick="togglePassword('new_password1')">
                                    <i class="fas fa-eye" id="new_password1_icon" style="color: #777;"></i>
                                </button>
                            </div>
                            {% if form.new_password1.errors %}
                                <div style="margin-top: 5px; color: #dc3545;">
                                    {% for error in form.new_password1.errors %}
                                        <small style="font-size: 0.85rem;">{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <small style="display: block; margin-top: 8px; color: #777; font-size: 0.85rem;">
                                <ul style="padding-left: 20px; margin: 5px 0;">
                                    <li>Tu contraseña no puede ser similar a tu información personal.</li>
                                    <li>Tu contraseña debe contener al menos 8 caracteres.</li>
                                    <li>Tu contraseña no puede ser una contraseña comúnmente utilizada.</li>
                                    <li>Tu contraseña no puede ser completamente numérica.</li>
                                </ul>
                            </small>
                        </div>

                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="new_password2" style="display: block; margin-bottom: 8px; color: #555; font-weight: 500;">
                                <i class="fas fa-lock" style="color: #d4af37; margin-right: 8px;"></i> Confirmar Nueva Contraseña
                            </label>
                            <div class="input-group" style="display: flex;">
                                <input type="password" style="flex: 1; border-radius: 5px 0 0 5px; border: 1px solid #e0e0e0; padding: 12px 15px; transition: all 0.3s ease;" id="new_password2" name="new_password2" required>
                                <button style="background: #f5f5f5; border: 1px solid #e0e0e0; border-left: none; border-radius: 0 5px 5px 0; padding: 0 15px; cursor: pointer;" type="button" onclick="togglePassword('new_password2')">
                                    <i class="fas fa-eye" id="new_password2_icon" style="color: #777;"></i>
                                </button>
                            </div>
                            {% if form.new_password2.errors %}
                                <div style="margin-top: 5px; color: #dc3545;">
                                    {% for error in form.new_password2.errors %}
                                        <small style="font-size: 0.85rem;">{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div style="margin-top: 30px;">
                            <button type="submit" style="width: 100%; background: linear-gradient(135deg, #d4af37, #f5cc7f); border: none; padding: 12px; border-radius: 5px; color: #fff; font-weight: 500; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);">
                                <i class="fas fa-save" style="margin-right: 10px;"></i> Cambiar Contraseña
                            </button>
                            <a href="{% url 'perfil' %}" style="width: 100%; background: #f5f5f5; border: 1px solid #e0e0e0; padding: 12px; border-radius: 5px; color: #555; font-weight: 500; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; text-decoration: none;">
                                <i class="fas fa-arrow-left" style="margin-right: 10px;"></i> Volver al Perfil
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(fieldId + '_icon');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Validación en tiempo real
document.getElementById('password-change-form').addEventListener('submit', function(e) {
    const newPassword1 = document.getElementById('new_password1').value;
    const newPassword2 = document.getElementById('new_password2').value;
    
    if (newPassword1 !== newPassword2) {
        e.preventDefault();
        alert('Las contraseñas no coinciden');
        return false;
    }
    
    if (newPassword1.length < 8) {
        e.preventDefault();
        alert('La contraseña debe tener al menos 8 caracteres');
        return false;
    }
});
</script>
{% endblock %}
